name: Go

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  workflow_dispatch:

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2

    - name: Set up Go
      uses: actions/setup-go@v2
      with:
        go-version: 1.16
    
    - name: Install Dependency
      run: go mod download github.com/cavaliercoder/grab && go get monun/server-script/utils/logger
    
    - name: Build macOS
      run: mkdir -p build/server_darwin_x64 && GOOS=darwin GOARCH=amd64 go build -o build/server_darwin_x64/server
    - name: Upload macOS Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: macOS
        path: ./build/server_darwin_x64/server
        
    - name: Build Linux x64
      run: mkdir -p build/server_linux_x64 && GOOS=linux GOARCH=amd64 go build -o build/server_linux_x64/server
    - name: Upload Linux x64 Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: Linux x64
        path: ./build/server_linux_x64/server
        
    - name: Build Linux x86
      run: mkdir -p build/server_linux_x86 && GOOS=linux GOARCH=386 go build -o build/server_linux_x86/server
    - name: Upload Linux x86 Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: Linux x86
        path: ./build/server_linux_x86/server
        
    - name: Build Windows x64
      run: mkdir -p build/server_win_x64 && GOOS=windows GOARCH=amd64 go build -o build/server_win_x64/server.exe
    - name: Upload Windows x64 Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: Windows x64
        path: ./build/server_win_x64/server.exe
        
    - name: Build Windows x86
      run: mkdir -p build/server_win_x86 && GOOS=windows GOARCH=386 go build -o build/server_win_x86/server.exe
    - name: Upload Windows x86 Artifact
      uses: actions/upload-artifact@v2.2.4
      with:
        name: Windows x86
        path: ./build/server_win_x86/server.exe
